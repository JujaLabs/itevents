<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">
    <changeSet id="017" author="vaa25">
        <sql>
            ALTER TABLE events
            ADD free BOOLEAN,
            ADD price INT,
            ADD currency_id INT,
            ADD city_id INT,
            ADD FOREIGN KEY(currency_id) REFERENCES currency,
            ADD FOREIGN KEY(city_id) REFERENCES city,
            ADD CHECK ((free = false AND price IS NOT NULL AND currency_id IS NOT NULL)OR
            (free = true AND price IS NULL AND currency_id IS NULL))
        </sql>

        <rollback>
            ALTER TABLE events DROP COLUMN free, price, currency_id, city_id;
        </rollback>
    </changeSet>
</databaseChangeLog>